// AI Chatbot Timeline Data
const aiData = {
  "chatgpt": {
    "name": "ChatGPT",
    "company": "OpenAI",
    "color": "#10a37f",
    "launch_date": "2022-11",
    "korean_users": "1092ÎßåÎ™Ö",
    "market_share": "34%",
    "milestones": [
      {
        "date": "2022-11",
        "title": "ChatGPT Ï≤´ Ï∂úÏãú",
        "description": "OpenAIÏóêÏÑú GPT-3.5 Í∏∞Î∞ò AI Ï±óÎ¥á Ï∂úÏãú"
      },
      {
        "date": "2024-02",
        "title": "1Ïñµ 8Ï≤úÎßå ÏÇ¨Ïö©Ïûê Îã¨ÏÑ±",
        "description": "Ï†Ñ ÏÑ∏Í≥Ñ AI Ï±óÎ¥á ÏãúÏû•ÏùÑ Ï£ºÎèÑÌïòÎäî ÏÇ¨Ïö©Ïûê Í∏∞Î∞ò ÌôïÎ≥¥"
      },
      {
        "date": "2025-03",
        "title": "ÌïúÍµ≠ ÏõîÍ∞Ñ ÏÇ¨Ïö©Ïûê 1092ÎßåÎ™Ö",
        "description": "ÌïúÍµ≠ÏóêÏÑú Ïó≠ÎåÄ ÏµúÍ≥†ÏπòÎ•º Îã¨ÏÑ±"
      },
      {
        "date": "2025-04",
        "title": "GPT-4.1 ÏãúÎ¶¨Ï¶à Ï∂úÏãú",
        "description": "SWE-bench VerifiedÏóêÏÑú 54.6% Ï†ïÌôïÎèÑ Í∏∞Î°ù"
      }
    ]
  },
  "gemini": {
    "name": "Gemini",
    "company": "Google",
    "color": "#4285f4",
    "launch_date": "2023-03",
    "korean_users": "ÏßëÍ≥ÑÎêòÏßÄ ÏïäÏùå",
    "market_share": "12%",
    "milestones": [
      {
        "date": "2023-03",
        "title": "Google Gemini Ï∂úÏãú",
        "description": "Î©ÄÌã∞Î™®Îã¨ ÏÉùÏÑ±Ìòï AI Î™®Îç∏Î°ú ÌÖçÏä§Ìä∏, Ïù¥ÎØ∏ÏßÄ, Ïò§ÎîîÏò§, ÎπÑÎîîÏò§ Ï≤òÎ¶¨"
      },
      {
        "date": "2023-06",
        "title": "Îã§ÏñëÌïú Î≤ÑÏ†Ñ Í∞úÎ∞ú",
        "description": "Gemini Ultra, Pro, Flash, Nano Î≤ÑÏ†Ñ Ï∂úÏãú"
      },
      {
        "date": "2024-01",
        "title": "Gemini 1.5 Pro Ï∂úÏãú",
        "description": "ÏµúÎåÄ 100Îßå Í∞úÏùò ÌÜ†ÌÅ∞ Ï≤òÎ¶¨ Îä•Î†• Î≥¥Ïú†"
      },
      {
        "date": "2025-01",
        "title": "Î©ÄÌã∞Î™®Îã¨ Í∏∞Îä• Í∞ïÌôî",
        "description": "Íµ¨Í∏Ä ÏÑúÎπÑÏä§ÏôÄÏùò Ïó∞ÎèôÏùÑ ÌÜµÌïú ÏóÖÎ¨¥ Ìö®Ïú®ÏÑ± Ìñ•ÏÉÅ"
      }
    ]
  },
  "claude": {
    "name": "Claude",
    "company": "Anthropic",
    "color": "#cc785c",
    "launch_date": "2023-03",
    "korean_users": "21ÎßåÎ™Ö",
    "market_share": "24%",
    "milestones": [
      {
        "date": "2023-03",
        "title": "Anthropic Claude Ï∂úÏãú",
        "description": "OpenAI Í∞úÎ∞úÏûêÎì§Ïù¥ ÏÑ§Î¶ΩÌïú AnthropicÏóêÏÑú Ï∂úÏãú"
      },
      {
        "date": "2024-03",
        "title": "Claude 3 ÏãúÎ¶¨Ï¶à Ï∂úÏãú",
        "description": "Haiku, Sonnet, Opus Î≤ÑÏ†ÑÏúºÎ°ú Îã§ÏñëÌïú ÏÑ±Îä• Ï†úÍ≥µ"
      },
      {
        "date": "2025-02",
        "title": "Claude 3.7 ÏÜåÎÑ§Ìä∏ Ï∂úÏãú",
        "description": "SWE-Î≤§ÏπòÏóêÏÑú 62.3% Ï†ïÌôïÎèÑÎ°ú 1ÏúÑ Îã¨ÏÑ±"
      },
      {
        "date": "2025-05",
        "title": "ÌÜµÌï© Í∏∞Îä• Ï∂îÍ∞Ä",
        "description": "ÏïÑÌãÄÎùºÏãúÏïà, ÏûêÌîºÏñ¥ Îì± 10Í∞ú Ïù∏Í∏∞ ÏÑúÎπÑÏä§ÏôÄ Ïó∞Í≤∞"
      }
    ]
  },
  "perplexity": {
    "name": "Perplexity AI",
    "company": "Perplexity AI",
    "color": "#20b2aa",
    "launch_date": "2022-12",
    "korean_users": "103ÎßåÎ™Ö",
    "market_share": "ÏÜåÍ∑úÎ™®",
    "milestones": [
      {
        "date": "2022-12",
        "title": "Perplexity AI Ï∂úÏãú",
        "description": "AIÏôÄ Ïã§ÏãúÍ∞Ñ Ïõπ Í≤ÄÏÉâÏùÑ Í≤∞Ìï©Ìïú 'Ïï§ÏÑú ÏóîÏßÑ'"
      },
      {
        "date": "2023-10",
        "title": "4,035Îßå Í±¥ Î∞©Î¨∏ Í∏∞Î°ù",
        "description": "ÌèâÍ∑† ÏÑ∏ÏÖò ÏãúÍ∞Ñ 21Î∂Ñ 58Ï¥à Îã¨ÏÑ±"
      },
      {
        "date": "2024-08",
        "title": "Ïõî 2Ïñµ 5Ï≤úÎßå Í∞ú ÏßàÎ¨∏ Ï≤òÎ¶¨",
        "description": "AI Í≤ÄÏÉâÏóê ÎåÄÌïú Ï¶ùÍ∞ÄÌïòÎäî ÏàòÏöî Î∞òÏòÅ"
      },
      {
        "date": "2025-03",
        "title": "ÌïúÍµ≠ ÏÇ¨Ïö©Ïûê 103ÎßåÎ™Ö",
        "description": "Íµ≠ÎÇ¥ ÏÉùÏÑ±Ìòï AI Ïï± 4ÏúÑ Í∏∞Î°ù"
      }
    ]
  },
  "grok": {
    "name": "Grok",
    "company": "xAI",
    "color": "#1d9bf0",
    "launch_date": "2023-11",
    "korean_users": "23ÎßåÎ™Ö",
    "market_share": "Ïã†Ìù•",
    "milestones": [
      {
        "date": "2023-11-03",
        "title": "xAI Grok Ï≤´ Ï∂úÏãú",
        "description": "ÏùºÎ°† Î®∏Ïä§ÌÅ¨ ÏÑ§Î¶Ω xAIÏùò Í≥†Í∏â Ï±óÎ¥á"
      },
      {
        "date": "2024-06",
        "title": "X ÌîåÎû´Ìèº ÌÜµÌï© Í∞ïÌôî",
        "description": "Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Ï†ëÍ∑ºÍ≥º ÏÜåÏÖú ÎØ∏ÎîîÏñ¥ Ïó∞Îèô"
      },
      {
        "date": "2025-02-18",
        "title": "Grok 3 Í≥µÍ∞ú",
        "description": "Ïù¥Ï†Ñ Î≤ÑÏ†Ñ ÎåÄÎπÑ 10Î∞∞ Ïó∞ÏÇ∞ Îä•Î†• Ìñ•ÏÉÅ"
      },
      {
        "date": "2025-03",
        "title": "ÌïúÍµ≠ Ï∂úÏãú",
        "description": "2Ï£ºÎßåÏóê 23ÎßåÎ™Ö ÏÇ¨Ïö©Ïûê ÌôïÎ≥¥"
      }
    ]
  },
  "deepseek": {
    "name": "DeepSeek",
    "company": "DeepSeek",
    "color": "#ff6b6b",
    "launch_date": "2023-05",
    "korean_users": "36ÎßåÎ™Ö",
    "market_share": "Í∏âÏÑ±Ïû•",
    "milestones": [
      {
        "date": "2023-05",
        "title": "Ï§ëÍµ≠ DeepSeek ÏÑ§Î¶Ω",
        "description": "ÎåÄÍ∑úÎ™® Ïñ∏Ïñ¥ Î™®Îç∏Í≥º Ï∂îÎ°† Î™®Îç∏ Í∞úÎ∞ú ÏãúÏûë"
      },
      {
        "date": "2024-12",
        "title": "DeepSeek-R1 Î™®Îç∏ Í∞úÎ∞ú",
        "description": "600Îßå Îã¨Îü¨ ÎπÑÏö©ÏúºÎ°ú Í≥†ÏÑ±Îä• Ï∂îÎ°† Î™®Îç∏ Í∞úÎ∞ú"
      },
      {
        "date": "2025-01",
        "title": "ÎØ∏Íµ≠ Ïï±Ïä§ÌÜ†Ïñ¥ 1ÏúÑ",
        "description": "Î¨¥Î£å AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ Ïï±ÏúºÎ°ú ChatGPT Ï†úÏπòÍ≥† 1ÏúÑ"
      },
      {
        "date": "2025-03",
        "title": "ÌïúÍµ≠ ÏÇ¨Ïö©Ïûê 36ÎßåÎ™Ö",
        "description": "Íµ≠ÎÇ¥ ÏÉùÏÑ±Ìòï AI Ïï± 6ÏúÑ Í∏∞Î°ù"
      }
    ]
  }
};

class TimelineApp {
  constructor() {
    this.currentYear = 'all';
    this.activeModels = new Set(Object.keys(aiData));
    this.isDarkTheme = false;
    this.init();
  }

  init() {
    this.setupEventListeners();
    this.generateTimeline();
    this.setupThemeToggle();
  }

  setupEventListeners() {
    // Year selector
    document.querySelectorAll('.year-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        this.handleYearChange(e.target.dataset.year);
      });
    });

    // Legend items
    document.querySelectorAll('.legend-item').forEach(item => {
      item.addEventListener('click', (e) => {
        this.handleLegendClick(e.currentTarget.dataset.model);
      });
    });

    // Modal close
    document.getElementById('modalClose').addEventListener('click', () => {
      this.closeModal();
    });

    document.getElementById('modalOverlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        this.closeModal();
      }
    });
  }

  handleYearChange(year) {
    this.currentYear = year;
    
    // Update button states
    document.querySelectorAll('.year-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.year === year);
    });

    this.filterTimeline();
  }

  handleLegendClick(model) {
    if (this.activeModels.has(model)) {
      this.activeModels.delete(model);
    } else {
      this.activeModels.add(model);
    }

    // Update legend item states
    document.querySelectorAll('.legend-item').forEach(item => {
      item.classList.toggle('active', this.activeModels.has(item.dataset.model));
    });

    this.filterTimeline();
  }

  generateTimeline() {
    const tracksContainer = document.getElementById('timelineTracks');
    tracksContainer.innerHTML = '';

    Object.entries(aiData).forEach(([modelKey, modelData]) => {
      const track = this.createTimelineTrack(modelKey, modelData);
      tracksContainer.appendChild(track);
    });
  }

  createTimelineTrack(modelKey, modelData) {
    const track = document.createElement('div');
    track.className = 'timeline-track';
    track.dataset.model = modelKey;

    // Create track line
    const trackLine = document.createElement('div');
    trackLine.className = 'track-line';
    trackLine.style.background = `linear-gradient(90deg, transparent 0%, ${modelData.color} 20%, ${modelData.color} 80%, transparent 100%)`;
    track.appendChild(trackLine);

    // Create nodes for each milestone
    modelData.milestones.forEach(milestone => {
      const node = this.createTimelineNode(modelKey, modelData, milestone);
      track.appendChild(node);
    });

    return track;
  }

  createTimelineNode(modelKey, modelData, milestone) {
    const node = document.createElement('div');
    node.className = 'timeline-node';
    node.style.backgroundColor = modelData.color;
    node.style.left = this.calculateNodePosition(milestone.date) + '%';
    node.dataset.model = modelKey;
    node.dataset.year = milestone.date.split('-')[0];

    // Create label
    const label = document.createElement('div');
    label.className = 'timeline-label';
    label.textContent = milestone.title;
    node.appendChild(label);

    // Add click handler
    node.addEventListener('click', () => {
      this.showMilestoneDetails(modelData, milestone);
    });

    return node;
  }

  calculateNodePosition(dateString) {
    // Parse date (format: YYYY-MM or YYYY-MM-DD)
    const [year, month = 1, day = 1] = dateString.split('-').map(Number);
    const date = new Date(year, month - 1, day);
    
    // Timeline spans from 2022-01 to 2025-12
    const startDate = new Date(2022, 0, 1);
    const endDate = new Date(2025, 11, 31);
    
    const totalDuration = endDate - startDate;
    const currentPosition = date - startDate;
    
    // Convert to percentage with some padding
    const percentage = (currentPosition / totalDuration) * 80 + 10; // 10% padding on each side
    
    return Math.max(5, Math.min(95, percentage));
  }

  filterTimeline() {
    document.querySelectorAll('.timeline-track').forEach(track => {
      const model = track.dataset.model;
      const isModelActive = this.activeModels.has(model);
      
      // Filter by active models
      if (!isModelActive) {
        track.classList.add('hidden');
        return;
      }

      // Filter by year
      if (this.currentYear === 'all') {
        track.classList.remove('hidden');
      } else {
        const hasMatchingYear = Array.from(track.querySelectorAll('.timeline-node'))
          .some(node => node.dataset.year === this.currentYear);
        
        track.classList.toggle('hidden', !hasMatchingYear);
      }

      // Filter individual nodes by year
      track.querySelectorAll('.timeline-node').forEach(node => {
        if (this.currentYear === 'all' || node.dataset.year === this.currentYear) {
          node.style.display = 'block';
        } else {
          node.style.display = 'none';
        }
      });
    });
  }

  showMilestoneDetails(modelData, milestone) {
    const modalBody = document.getElementById('modalBody');
    
    modalBody.innerHTML = `
      <h3 style="color: ${modelData.color}">${milestone.title}</h3>
      <div class="company-name">${modelData.company} - ${modelData.name}</div>
      <div class="milestone-date">${this.formatDate(milestone.date)}</div>
      <div class="milestone-description">${milestone.description}</div>
      <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--color-card-border-inner);">
        <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
          <strong>ÌïúÍµ≠ ÏÇ¨Ïö©Ïûê:</strong> ${modelData.korean_users}<br>
          <strong>ÏãúÏû• Ï†êÏú†Ïú®:</strong> ${modelData.market_share}
        </div>
      </div>
    `;

    document.getElementById('modalOverlay').classList.add('active');
  }

  closeModal() {
    document.getElementById('modalOverlay').classList.remove('active');
  }

  formatDate(dateString) {
    const [year, month = 1, day] = dateString.split('-').map(Number);
    
    if (day) {
      return `${year}ÎÖÑ ${month}Ïõî ${day}Ïùº`;
    } else {
      return `${year}ÎÖÑ ${month}Ïõî`;
    }
  }

  setupThemeToggle() {
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = themeToggle.querySelector('.theme-icon');
    
    // Check for saved theme preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      this.isDarkTheme = savedTheme === 'dark';
      this.applyTheme();
    }

    themeToggle.addEventListener('click', () => {
      this.isDarkTheme = !this.isDarkTheme;
      this.applyTheme();
      localStorage.setItem('theme', this.isDarkTheme ? 'dark' : 'light');
    });
  }

  applyTheme() {
    const body = document.body;
    const themeIcon = document.querySelector('.theme-icon');
    
    if (this.isDarkTheme) {
      body.setAttribute('data-theme', 'dark');
      themeIcon.textContent = '‚òÄÔ∏è';
    } else {
      body.removeAttribute('data-theme');
      themeIcon.textContent = 'üåô';
    }
  }
}

// Smooth scrolling utility
function smoothScrollTo(element, duration = 800) {
  const targetPosition = element.offsetLeft;
  const startPosition = element.parentElement.scrollLeft;
  const distance = targetPosition - startPosition;
  let startTime = null;

  function animation(currentTime) {
    if (startTime === null) startTime = currentTime;
    const timeElapsed = currentTime - startTime;
    const run = ease(timeElapsed, startPosition, distance, duration);
    element.parentElement.scrollLeft = run;
    if (timeElapsed < duration) requestAnimationFrame(animation);
  }

  function ease(t, b, c, d) {
    t /= d / 2;
    if (t < 1) return c / 2 * t * t + b;
    t--;
    return -c / 2 * (t * (t - 2) - 1) + b;
  }

  requestAnimationFrame(animation);
}

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  new TimelineApp();

  // Add some interactive enhancements
  const timelineContainer = document.querySelector('.timeline-container');
  if (timelineContainer) {
    // Add horizontal scroll wheel support
    timelineContainer.addEventListener('wheel', (e) => {
      if (e.deltaY !== 0) {
        e.preventDefault();
        timelineContainer.scrollLeft += e.deltaY;
      }
    });

    // Add touch support for mobile
    let isDown = false;
    let startX;
    let scrollLeft;

    timelineContainer.addEventListener('mousedown', (e) => {
      isDown = true;
      timelineContainer.style.cursor = 'grabbing';
      startX = e.pageX - timelineContainer.offsetLeft;
      scrollLeft = timelineContainer.scrollLeft;
    });

    timelineContainer.addEventListener('mouseleave', () => {
      isDown = false;
      timelineContainer.style.cursor = 'grab';
    });

    timelineContainer.addEventListener('mouseup', () => {
      isDown = false;
      timelineContainer.style.cursor = 'grab';
    });

    timelineContainer.addEventListener('mousemove', (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - timelineContainer.offsetLeft;
      const walk = (x - startX) * 2;
      timelineContainer.scrollLeft = scrollLeft - walk;
    });
  }

  // Add keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key >= '1' && e.key <= '5') {
      const years = ['2022', '2023', '2024', '2025', 'all'];
      const yearIndex = parseInt(e.key) - 1;
      if (yearIndex < years.length) {
        const yearBtn = document.querySelector(`[data-year="${years[yearIndex]}"]`);
        if (yearBtn) yearBtn.click();
      }
    }
  });

  // Add loading animation
  const tracks = document.querySelectorAll('.timeline-track');
  tracks.forEach((track, index) => {
    track.style.animationDelay = `${index * 100}ms`;
  });
});